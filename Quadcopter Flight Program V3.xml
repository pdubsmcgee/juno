<?xml version='1.0' encoding='utf-8'?>
<Program name="Quadcopter Flight Program V3.31">
  <Variables>
    <Variable name="auto_enabled" number="0" />
    <Variable name="manual_override" number="0" />
    <Variable name="landing_armed" number="0" />
    <Variable name="nav_enabled" number="0" />
    <Variable name="hover_alt_agl" number="0" />
    <Variable name="hover_alt_target" number="0" />
    <Variable name="auto_alt_agl" number="0" />
    <Variable name="target_alt_agl" number="0" />
    <Variable name="target_north_m" number="0" />
    <Variable name="target_east_m" number="0" />
    <Variable name="target_tolerance_m" number="0" />
    <Variable name="target_enter_tol_m" number="0" />
    <Variable name="target_exit_tol_m" number="0" />
    <Variable name="target_in_range_time_s" number="0" />
    <Variable name="target_capture_dwell_s" number="0" />
    <Variable name="target_captured" number="0" />
    <Variable name="home_pos" number="0" />
    <Variable name="north_hat" number="0" />
    <Variable name="east_hat" number="0" />
    <Variable name="target_pos" number="0" />
    <Variable name="current_pos" number="0" />
    <Variable name="to_target" number="0" />
    <Variable name="distance_to_target" number="0" />
    <Variable name="to_target_hat" number="0" />
    <Variable name="ncomp" number="0" />
    <Variable name="ecomp" number="0" />
    <Variable name="headingrad" number="0" />
    <Variable name="headingdeg" number="0" />
    <Variable name="prop_pitch_deg" number="0" />
    <Variable name="prop_pitch_step" number="0" />
    <Variable name="prop_pitch_thrust_prev" number="0" />
    <Variable name="prop_pitch_thrust_now" number="0" />
    <Variable name="prop_pitch_throttle_zero_s" number="0" />
    <Variable name="ag1_takeoff_hold_cmd" number="0" />
    <Variable name="ag2_land_cmd" number="0" />
    <Variable name="ag3_manual_cmd" number="0" />
    <Variable name="ag4_nav_cmd" number="0" />
    <Variable name="debug_enabled" number="0" />
    <Variable name="debug_period_s" number="0" />
    <Variable name="debug_msg" number="0" />
    <Variable name="throttle_cmd" number="0" />
    <Variable name="alt_error" number="0" />
    <Variable name="alt_error_int" number="0" />
    <Variable name="ki_alt" number="0" />
    <Variable name="int_min" number="0" />
    <Variable name="int_max" number="0" />
    <Variable name="pitch_cmd" number="0" />
    <Variable name="nav_heading_cmd" number="0" />
    <Variable name="nav_heading_error_deg" number="0" />
    <Variable name="heading_hold_enabled" number="0" />
    <Variable name="thread_safe_mode" number="0" />
    <Variable name="desired_alt_agl" number="0" />
    <Variable name="desired_heading" number="0" />
    <Variable name="desired_pitch" number="0" />
    <Variable name="desired_heading_hold" number="0" />

    <Variable name="ProgramState" number="0" />
    <Variable name="RequestedState" number="0" />
    <Variable name="StateChangePending" number="0" />
    <Variable name="StandbyActive" number="0" />
    <Variable name="AscentActive" number="0" />
    <Variable name="OrbitActive" number="0" />
    <Variable name="LandingActive" number="0" />
    <Variable name="HoverActive" number="0" />
  </Variables>
  <Instructions>
    <Event event="FlightStart" id="0" style="flight-start" pos="0,0" />
    <Comment id="1" style="comment" pos="0,130">
      <Constant style="comment-text" canReplace="false" text="AG1: takeoff + altitude hold | AG4: start nav to target | AG2: land | AG3: manual override" />
    </Comment>
    <SetVariable id="2" style="set-variable" pos="0,260">
      <Variable list="false" local="false" variableName="auto_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="3" style="set-variable" pos="0,390">
      <Variable list="false" local="false" variableName="manual_override" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="4" style="set-variable" pos="0,520">
      <Variable list="false" local="false" variableName="landing_armed" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="5" style="set-variable" pos="0,650">
      <Variable list="false" local="false" variableName="nav_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="304" style="set-variable" pos="0,780">
      <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="305" style="set-variable" pos="0,910">
      <Variable list="false" local="false" variableName="ag2_land_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="306" style="set-variable" pos="0,1040">
      <Variable list="false" local="false" variableName="ag3_manual_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="307" style="set-variable" pos="0,1170">
      <Variable list="false" local="false" variableName="ag4_nav_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9600" style="set-variable" pos="0,1235">
      <Variable list="false" local="false" variableName="debug_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9601" style="set-variable" pos="0,1265">
      <Variable list="false" local="false" variableName="debug_period_s" />
      <Constant text="0.5" />
    </SetVariable>
    <SetVariable id="331" style="set-variable" pos="0,1300">
      <Variable list="false" local="false" variableName="throttle_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9201" style="set-variable" pos="0,1365">
      <Variable list="false" local="false" variableName="alt_error" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9202" style="set-variable" pos="0,1395">
      <Variable list="false" local="false" variableName="alt_error_int" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9203" style="set-variable" pos="0,1425">
      <Variable list="false" local="false" variableName="ki_alt" />
      <Constant text="0.0006" />
    </SetVariable>
    <SetVariable id="9204" style="set-variable" pos="0,1455">
      <Variable list="false" local="false" variableName="int_min" />
      <Constant text="-200" />
    </SetVariable>
    <SetVariable id="9205" style="set-variable" pos="0,1485">
      <Variable list="false" local="false" variableName="int_max" />
      <Constant text="200" />
    </SetVariable>
    <SetVariable id="332" style="set-variable" pos="0,1430">
      <Variable list="false" local="false" variableName="pitch_cmd" />
      <Constant text="90" />
    </SetVariable>
    <SetVariable id="333" style="set-variable" pos="0,1560">
      <Variable list="false" local="false" variableName="nav_heading_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="391" style="set-variable" pos="0,1690">
      <Variable list="false" local="false" variableName="nav_heading_error_deg" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="334" style="set-variable" pos="0,1820">
      <Variable list="false" local="false" variableName="heading_hold_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9401" style="set-variable" pos="0,1880">
      <Variable list="false" local="false" variableName="desired_alt_agl" />
      <CraftProperty property="Altitude.AGL" style="prop-altitude" />
    </SetVariable>
    <SetVariable id="9402" style="set-variable" pos="0,1910">
      <Variable list="false" local="false" variableName="desired_heading" />
      <CraftProperty property="Heading" style="prop-heading" />
    </SetVariable>
    <SetVariable id="9403" style="set-variable" pos="0,1940">
      <Variable list="false" local="false" variableName="desired_pitch" />
      <Constant text="90" />
    </SetVariable>
    <SetVariable id="9404" style="set-variable" pos="0,1970">
      <Variable list="false" local="false" variableName="desired_heading_hold" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="362" style="set-variable" pos="0,1950">
      <Variable list="false" local="false" variableName="thread_safe_mode" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="6" style="set-variable" pos="0,2080">
      <Variable list="false" local="false" variableName="target_north_m" />
      <Constant text="1200" />
    </SetVariable>
    <SetVariable id="7" style="set-variable" pos="0,2210">
      <Variable list="false" local="false" variableName="target_east_m" />
      <Constant text="800" />
    </SetVariable>
    <SetVariable id="8" style="set-variable" pos="0,2340">
      <Variable list="false" local="false" variableName="target_tolerance_m" />
      <Constant text="100" />
    </SetVariable>
    <SetVariable id="9301" style="set-variable" pos="0,2400">
      <Variable list="false" local="false" variableName="target_enter_tol_m" />
      <Variable list="false" local="false" variableName="target_tolerance_m" />
    </SetVariable>
    <SetVariable id="9302" style="set-variable" pos="0,2460">
      <Variable list="false" local="false" variableName="target_exit_tol_m" />
      <BinaryOp op="*" style="op-mul">
        <Variable list="false" local="false" variableName="target_enter_tol_m" />
        <Constant text="1.2" />
      </BinaryOp>
    </SetVariable>
    <SetVariable id="9303" style="set-variable" pos="0,2520">
      <Variable list="false" local="false" variableName="target_in_range_time_s" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9304" style="set-variable" pos="0,2580">
      <Variable list="false" local="false" variableName="target_capture_dwell_s" />
      <Constant text="1.5" />
    </SetVariable>
    <SetVariable id="9305" style="set-variable" pos="0,2640">
      <Variable list="false" local="false" variableName="target_captured" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9069" style="set-variable" pos="0,2470">
      <Variable list="false" local="false" variableName="target_alt_agl" />
      <Constant text="500" />
    </SetVariable>
    <SetVariable id="9" style="set-variable" pos="0,2600">
      <Variable list="false" local="false" variableName="hover_alt_agl" />
      <CraftProperty property="Altitude.AGL" style="prop-altitude" />
    </SetVariable>
    <SetVariable id="9072" style="set-variable" pos="0,2730">
      <Variable list="false" local="false" variableName="hover_alt_target" />
      <Variable list="false" local="false" variableName="hover_alt_agl" />
    </SetVariable>
    <SetVariable id="10" style="set-variable" pos="0,2860">
      <Variable list="false" local="false" variableName="home_pos" />
      <CraftProperty property="Nav.Position" style="prop-nav" />
    </SetVariable>
    <SetVariable id="170" style="set-variable" pos="0,2990">
      <Variable list="false" local="false" variableName="prop_pitch_deg" />
      <Constant text="50" />
    </SetVariable>
    <SetVariable id="171" style="set-variable" pos="0,3120">
      <Variable list="false" local="false" variableName="prop_pitch_step" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="172" style="set-variable" pos="0,3250">
      <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
      <CraftProperty property="Performance.CurrentEngineThrust" style="prop-performance" />
    </SetVariable>
    <SetVariable id="190" style="set-variable" pos="0,3380">
      <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
      <Constant text="0" />
    </SetVariable>
    <DisplayMessage id="11" style="display" pos="0,3510">
      <Constant text="Ready. AG1 takeoff/hold, AG4 nav, AG2 land, AG3 manual." />
      <Constant number="7" />
    </DisplayMessage>
    <LogFlight id="360" style="flightlog" pos="0,3640">
      <Constant text="Quadcopter controller initialized: AG1 takeoff/hold, AG4 nav, AG2 land, AG3 manual." />
      <Constant style="false" bool="false" />
    </LogFlight>
    <Comment id="9602" style="comment" pos="0,3710">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: diagnostics (low-rate compact tuple; set debug_enabled=1 to enable)." />
    </Comment>
    <Event event="FlightStart" id="9603" style="flight-start" pos="0,3840" />
    <While id="9604" style="while" pos="0,3970">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="9605" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="debug_enabled" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <SetVariable id="9609" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="DBG m/n/l=" /></SetVariable>
            <SetVariable id="9610" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="manual_override" /></BinaryOp></SetVariable>
            <SetVariable id="9611" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9612" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="nav_enabled" /></BinaryOp></SetVariable>
            <SetVariable id="9613" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9614" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="landing_armed" /></BinaryOp></SetVariable>
            <SetVariable id="9615" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text=" altA/H=" /></BinaryOp></SetVariable>
            <SetVariable id="9616" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="auto_alt_agl" /></BinaryOp></SetVariable>
            <SetVariable id="9617" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9618" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="hover_alt_target" /></BinaryOp></SetVariable>
            <SetVariable id="9619" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text=" err d/a/v=" /></BinaryOp></SetVariable>
            <SetVariable id="9620" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="distance_to_target" /></BinaryOp></SetVariable>
            <SetVariable id="9621" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9622" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="alt_error" /></BinaryOp></SetVariable>
            <SetVariable id="9623" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9624" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" /></BinaryOp></SetVariable>
            <SetVariable id="9625" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text=" cmd t/p/pp=" /></BinaryOp></SetVariable>
            <SetVariable id="9626" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="throttle_cmd" /></BinaryOp></SetVariable>
            <SetVariable id="9627" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9628" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="pitch_cmd" /></BinaryOp></SetVariable>
            <SetVariable id="9629" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Constant text="/" /></BinaryOp></SetVariable>
            <SetVariable id="9630" style="set-variable"><Variable list="false" local="false" variableName="debug_msg" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="debug_msg" /><Variable list="false" local="false" variableName="prop_pitch_deg" /></BinaryOp></SetVariable>
            <DisplayMessage id="9606" style="display"><Variable list="false" local="false" variableName="debug_msg" /><Constant number="0.6" /></DisplayMessage>
            <LogFlight id="9607" style="flightlog"><Variable list="false" local="false" variableName="debug_msg" /><Constant style="false" bool="false" /></LogFlight>
          </Instructions>
        </If>
        <WaitSeconds id="9608" style="wait-seconds"><Variable list="false" local="false" variableName="debug_period_s" /></WaitSeconds>
      </Instructions>
    </While>
    <Comment id="9405" style="comment" pos="0,3640">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: targets (mode-aware setpoint generation only)." />
    </Comment>
    <While id="12" style="while" pos="0,3770">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="9406" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <SetVariable id="9407" style="set-variable"><Variable list="false" local="false" variableName="desired_alt_agl" /><CraftProperty property="Altitude.AGL" style="prop-altitude" /></SetVariable>
            <SetVariable id="9408" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
            <SetVariable id="9409" style="set-variable"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
            <SetVariable id="9410" style="set-variable"><Variable list="false" local="false" variableName="desired_heading" /><CraftProperty property="Heading" style="prop-heading" /></SetVariable>
          </Instructions>
        </If>
        <ElseIf id="9411" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <If id="9412" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="landing_armed" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <SetVariable id="9413" style="set-variable"><Variable list="false" local="false" variableName="desired_alt_agl" /><Constant text="0" /></SetVariable>
                <SetVariable id="9414" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
                <SetVariable id="9415" style="set-variable"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
              </Instructions>
            </If>
            <ElseIf id="9416" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <SetVariable id="9417" style="set-variable"><Variable list="false" local="false" variableName="desired_alt_agl" /><Variable list="false" local="false" variableName="hover_alt_target" /></SetVariable>
                <If id="9418" style="if">
                  <Comparison op="=" style="op-eq">
                    <Variable list="false" local="false" variableName="nav_enabled" />
                    <Constant text="1" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="9419" style="set-variable"><Variable list="false" local="false" variableName="target_pos" /><Vector3 style="vector3"><Variable list="false" local="false" variableName="target_north_m" /><Variable list="false" local="false" variableName="target_east_m" /><Constant text="0" /></Vector3></SetVariable>
                    <SetVariable id="9420" style="set-variable"><Variable list="false" local="false" variableName="current_pos" /><BinaryOp op="-" style="op-sub"><CraftProperty property="Nav.Position" style="prop-nav" /><Variable list="false" local="false" variableName="home_pos" /></BinaryOp></SetVariable>
                    <SetVariable id="9421" style="set-variable"><Variable list="false" local="false" variableName="to_target" /><BinaryOp op="-" style="op-sub"><Variable list="false" local="false" variableName="target_pos" /><Variable list="false" local="false" variableName="current_pos" /></BinaryOp></SetVariable>
                    <SetVariable id="9422" style="set-variable"><Variable list="false" local="false" variableName="distance_to_target" /><Function functionName="Magnitude" style="function"><Variable list="false" local="false" variableName="to_target" /></Function></SetVariable>
                    <SetVariable id="9423" style="set-variable"><Variable list="false" local="false" variableName="desired_heading" /><BinaryOp op="+" style="op-add"><Constant text="90" /><BinaryOp op="*" style="op-mul"><Function functionName="atan2" style="function"><GetVector id="94231" style="get-vector"><Variable list="false" local="false" variableName="to_target" /><Constant text="1" /></GetVector><GetVector id="94232" style="get-vector"><Variable list="false" local="false" variableName="to_target" /><Constant text="0" /></GetVector></Function><Constant text="57.2958" /></BinaryOp></BinaryOp></SetVariable>
                    <SetVariable id="9424" style="set-variable"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="1" /></SetVariable>
                    <If id="9425" style="if"><Comparison op="g" style="op-gt"><Variable list="false" local="false" variableName="distance_to_target" /><Constant text="250" /></Comparison><Instructions><SetVariable id="9426" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="75" /></SetVariable></Instructions></If>
                    <ElseIf id="9427" style="else"><Comparison op="g" style="op-gt"><Variable list="false" local="false" variableName="distance_to_target" /><Constant text="120" /></Comparison><Instructions><SetVariable id="9428" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="82" /></SetVariable></Instructions></ElseIf>
                    <ElseIf id="9429" style="else"><Constant style="true" bool="true" /><Instructions><SetVariable id="9430" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable></Instructions></ElseIf>
                  </Instructions>
                </If>
                <ElseIf id="9431" style="else">
                  <Constant style="true" bool="true" />
                  <Instructions>
                    <SetVariable id="9432" style="set-variable"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
                    <SetVariable id="9433" style="set-variable"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
                    <SetVariable id="9434" style="set-variable"><Variable list="false" local="false" variableName="desired_heading" /><CraftProperty property="Heading" style="prop-heading" /></SetVariable>
                  </Instructions>
                </ElseIf>
              </Instructions>
            </ElseIf>
          </Instructions>
        </ElseIf>
        <WaitSeconds id="9435" style="wait-seconds"><Constant text="0.05" /></WaitSeconds>
      </Instructions>
    </While>
    <Comment id="9436" style="comment" pos="0,3900">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: controller (setpoints + telemetry -> throttle_cmd/attitude commands)." />
    </Comment>
    <Event event="FlightStart" id="9437" style="flight-start" pos="0,4030" />
    <While id="9438" style="while" pos="0,4160">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="9439" style="if">
          <Comparison op="=" style="op-eq"><Variable list="false" local="false" variableName="manual_override" /><Constant text="0" /></Comparison>
          <Instructions>
            <SetVariable id="9440" style="set-variable"><Variable list="false" local="false" variableName="alt_error" /><BinaryOp op="-" style="op-sub"><Variable list="false" local="false" variableName="desired_alt_agl" /><CraftProperty property="Altitude.AGL" style="prop-altitude" /></BinaryOp></SetVariable>
            <SetVariable id="9441" style="set-variable"><Variable list="false" local="false" variableName="alt_error_int" /><BinaryOp op="+" style="op-add"><Variable list="false" local="false" variableName="alt_error_int" /><BinaryOp op="*" style="op-mul"><Variable list="false" local="false" variableName="alt_error" /><Constant text="0.05" /></BinaryOp></BinaryOp></SetVariable>
            <If id="9442" style="if"><Comparison op="l" style="op-lt"><Variable list="false" local="false" variableName="alt_error_int" /><Variable list="false" local="false" variableName="int_min" /></Comparison><Instructions><SetVariable id="9443" style="set-variable"><Variable list="false" local="false" variableName="alt_error_int" /><Variable list="false" local="false" variableName="int_min" /></SetVariable></Instructions></If>
            <If id="9444" style="if"><Comparison op="g" style="op-gt"><Variable list="false" local="false" variableName="alt_error_int" /><Variable list="false" local="false" variableName="int_max" /></Comparison><Instructions><SetVariable id="9445" style="set-variable"><Variable list="false" local="false" variableName="alt_error_int" /><Variable list="false" local="false" variableName="int_max" /></SetVariable></Instructions></If>
            <SetVariable id="9446" style="set-variable"><Variable list="false" local="false" variableName="throttle_cmd" /><BinaryOp op="-" style="op-sub"><BinaryOp op="+" style="op-add"><Constant text="0.5" /><BinaryOp op="+" style="op-add"><BinaryOp op="*" style="op-mul"><Constant text="0.005" /><Variable list="false" local="false" variableName="alt_error" /></BinaryOp><BinaryOp op="*" style="op-mul"><Variable list="false" local="false" variableName="ki_alt" /><Variable list="false" local="false" variableName="alt_error_int" /></BinaryOp></BinaryOp></BinaryOp><BinaryOp op="*" style="op-mul"><Constant text="0.02" /><CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" /></BinaryOp></BinaryOp></SetVariable>
            <If id="9447" style="if"><Comparison op="l" style="op-lt"><Variable list="false" local="false" variableName="throttle_cmd" /><Constant text="0" /></Comparison><Instructions><SetVariable id="9448" style="set-variable"><Variable list="false" local="false" variableName="throttle_cmd" /><Constant text="0" /></SetVariable></Instructions></If>
            <If id="9449" style="if"><Comparison op="g" style="op-gt"><Variable list="false" local="false" variableName="throttle_cmd" /><Constant text="1" /></Comparison><Instructions><SetVariable id="9450" style="set-variable"><Variable list="false" local="false" variableName="throttle_cmd" /><Constant text="1" /></SetVariable></Instructions></If>
            <SetVariable id="9451" style="set-variable"><Variable list="false" local="false" variableName="pitch_cmd" /><Variable list="false" local="false" variableName="desired_pitch" /></SetVariable>
            <SetVariable id="9452" style="set-variable"><Variable list="false" local="false" variableName="heading_hold_enabled" /><Variable list="false" local="false" variableName="desired_heading_hold" /></SetVariable>
            <SetVariable id="9453" style="set-variable"><Variable list="false" local="false" variableName="nav_heading_cmd" /><Variable list="false" local="false" variableName="desired_heading" /></SetVariable>
          </Instructions>
        </If>
        <ElseIf id="9454" style="else"><Constant style="true" bool="true" /><Instructions><SetVariable id="9455" style="set-variable"><Variable list="false" local="false" variableName="alt_error_int" /><Constant text="0" /></SetVariable></Instructions></ElseIf>
        <WaitSeconds id="9456" style="wait-seconds"><Constant text="0.05" /></WaitSeconds>
      </Instructions>
    </While>
    <Comment id="356" style="comment" pos="0,3900">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: actuators (writes slider1 from throttle_cmd only)." />
    </Comment>
    <Event event="FlightStart" id="344" style="flight-start" pos="0,4030" />
    <While id="345" style="while" pos="0,4160">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="346" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <SetInput input="slider1" id="347" style="set-input">
              <Variable list="false" local="false" variableName="throttle_cmd" />
            </SetInput>
          </Instructions>
        </If>
        <WaitSeconds id="348" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="357" style="comment" pos="0,4290">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: actuators (applies pitch/heading attitude commands)." />
    </Comment>
    <Event event="FlightStart" id="349" style="flight-start" pos="0,4420" />
    <While id="350" style="while" pos="0,4550">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="351" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <SetTargetHeading property="pitch" id="352" style="set-heading">
              <Variable list="false" local="false" variableName="pitch_cmd" />
            </SetTargetHeading>
            <If id="353" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="heading_hold_enabled" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <If id="371" style="if">
                  <Comparison op="l" style="op-lt">
                    <Variable list="false" local="false" variableName="nav_heading_cmd" />
                    <Constant text="0" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="372" style="set-variable">
                      <Variable list="false" local="false" variableName="nav_heading_cmd" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="nav_heading_cmd" />
                        <Constant text="360" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <If id="373" style="if">
                  <Comparison op="g" style="op-gt">
                    <Variable list="false" local="false" variableName="nav_heading_cmd" />
                    <Constant text="360" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="374" style="set-variable">
                      <Variable list="false" local="false" variableName="nav_heading_cmd" />
                      <BinaryOp op="-" style="op-sub">
                        <Variable list="false" local="false" variableName="nav_heading_cmd" />
                        <Constant text="360" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <SetTargetHeading property="heading" id="354" style="set-heading">
                  <Variable list="false" local="false" variableName="nav_heading_cmd" />
                </SetTargetHeading>
              </Instructions>
            </If>
          </Instructions>
        </If>
        <WaitSeconds id="355" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="358" style="comment" pos="0,4680">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: state (AG1/AG2/AG3/AG4 command ingestion)." />
    </Comment>
    <Event event="FlightStart" id="300" style="flight-start" pos="0,4810" />
    <While id="301" style="while" pos="0,4940">
      <Constant style="true" bool="true" />
      <Instructions>
        <SetVariable id="308" style="set-variable">
          <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="1" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="309" style="set-variable">
          <Variable list="false" local="false" variableName="ag2_land_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="2" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="310" style="set-variable">
          <Variable list="false" local="false" variableName="ag3_manual_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="3" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="311" style="set-variable">
          <Variable list="false" local="false" variableName="ag4_nav_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="4" />
          </ActivationGroup>
        </SetVariable>
        <If id="312" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="ag3_manual_cmd" />
            <Constant style="true" bool="true" />
          </Comparison>
          <Instructions>
            <SetVariable id="313" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9061" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="9062" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="314" style="set-variable">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="315" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <ElseIf id="316" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <SetVariable id="317" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </ElseIf>
        <If id="375" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="thread_safe_mode" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <If id="376" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="manual_override" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <SetVariable id="377" style="set-variable">
                  <Variable list="false" local="false" variableName="auto_enabled" />
                  <Constant text="0" />
                </SetVariable>
                <SetVariable id="378" style="set-variable">
                  <Variable list="false" local="false" variableName="nav_enabled" />
                  <Constant text="0" />
                </SetVariable>
                <SetVariable id="379" style="set-variable">
                  <Variable list="false" local="false" variableName="desired_heading_hold" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </If>
          </Instructions>
        </If>
        <If id="318" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
            <Constant style="true" bool="true" />
          </Comparison>
          <Instructions>
            <SetVariable id="319" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="9064" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9065" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="320" style="set-variable">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="321" style="set-variable">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="322" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="323" style="set-variable">
              <Variable list="false" local="false" variableName="hover_alt_target" />
              <BinaryOp op="+" style="op-add">
                <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                <Variable list="false" local="false" variableName="target_alt_agl" />
              </BinaryOp>
            </SetVariable>
            <SetVariable id="324" style="set-variable">
              <Variable list="false" local="false" variableName="home_pos" />
              <CraftProperty property="Nav.Position" style="prop-nav" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="325" style="if">
          <BoolOp op="and" style="op-and">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="ag4_nav_cmd" />
              <Constant style="true" bool="true" />
            </Comparison>
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="9067" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="2" />
            </SetVariable>
            <SetVariable id="9068" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="326" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9313" style="set-variable">
              <Variable list="false" local="false" variableName="target_in_range_time_s" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="9314" style="set-variable">
              <Variable list="false" local="false" variableName="target_captured" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="327" style="if">
          <BoolOp op="and" style="op-and">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="ag2_land_cmd" />
              <Constant style="true" bool="true" />
            </Comparison>
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="9070" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="3" />
            </SetVariable>
            <SetVariable id="9071" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="328" style="set-variable">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9221" style="set-variable">
              <Variable list="false" local="false" variableName="alt_error_int" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="329" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <WaitSeconds id="330" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="9080" style="comment" pos="0,5070">
      <Constant style="comment-text" canReplace="false" text="Thread ownership: state (broadcasts STATE_* transitions)." />
    </Comment>
    <Event event="FlightStart" id="9081" style="flight-start" pos="0,5200" />
    <While id="9082" style="while" pos="0,5330">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="9083" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="StateChangePending" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <If id="9084" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="0" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9085" style="broadcast-msg-craft">
                  <Constant text="STATE_STANDBY" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </If>
            <ElseIf id="9086" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9087" style="broadcast-msg-craft">
                  <Constant text="STATE_ASCENT" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9088" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="2" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9089" style="broadcast-msg-craft">
                  <Constant text="STATE_ORBIT" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9090" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="3" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9091" style="broadcast-msg-craft">
                  <Constant text="STATE_LANDING" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9092" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="4" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9093" style="broadcast-msg-craft">
                  <Constant text="STATE_HOVER" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
          </Instructions>
        </If>
        <WaitSeconds id="9094" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="359" style="comment" pos="0,5460">
      <Constant style="comment-text" canReplace="false" text="Thread: variable-pitch prop optimization with zero-throttle and landing safeguards." />
    </Comment>
    <Event event="FlightStart" id="173" style="flight-start" pos="0,5590" />
    <While id="174" style="while" pos="0,5720">
      <Constant style="true" bool="true" />
      <Instructions>
        <SetVariable id="175" style="set-variable">
          <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
          <CraftProperty property="Performance.CurrentEngineThrust" style="prop-performance" />
        </SetVariable>
        <If id="176" style="if">
          <BoolOp op="or" style="op-or">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="1" />
            </Comparison>
            <Comparison op="l" style="op-lt">
              <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
              <Constant text="0.01" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="177" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="50" />
            </SetVariable>
            <SetVariable id="178" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="179" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <ElseIf id="180" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <If id="181" style="if">
              <Comparison op="l" style="op-lt">
                <CraftProperty property="Input.Throttle" style="prop-input" />
                <Constant text="0.01" />
              </Comparison>
              <Instructions>
                <SetVariable id="182" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                  <BinaryOp op="+" style="op-add">
                    <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                    <CraftProperty property="Time.FrameDeltaTime" style="prop-time" />
                  </BinaryOp>
                </SetVariable>
              </Instructions>
            </If>
            <ElseIf id="183" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <SetVariable id="184" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </ElseIf>
            <If id="185" style="if">
              <Comparison op="g" style="op-gt">
                <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                <Constant text="2" />
              </Comparison>
              <Instructions>
                <SetVariable id="186" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_deg" />
                  <Constant text="50" />
                </SetVariable>
                <SetVariable id="187" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_step" />
                  <Constant text="1" />
                </SetVariable>
              </Instructions>
            </If>
            <ElseIf id="188" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <If id="189" style="if">
                  <Comparison op="g" style="op-gt">
                    <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
                    <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="191" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_deg" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="prop_pitch_deg" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <ElseIf id="192" style="else">
                  <Constant style="true" bool="true" />
                  <Instructions>
                    <SetVariable id="193" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_step" />
                      <BinaryOp op="*" style="op-mul">
                        <Constant text="-1" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                    <SetVariable id="194" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_deg" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="prop_pitch_deg" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </ElseIf>
              </Instructions>
            </ElseIf>
          </Instructions>
        </ElseIf>
        <If id="195" style="if">
          <Comparison op="g" style="op-gt">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="90" />
          </Comparison>
          <Instructions>
            <SetVariable id="196" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="90" />
            </SetVariable>
            <SetVariable id="197" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="-1" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="198" style="if">
          <Comparison op="l" style="op-lt">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <SetVariable id="199" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="200" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="1" />
            </SetVariable>
          </Instructions>
        </If>
        <SetInput input="slider2" id="201" style="set-input">
          <BinaryOp op="/" style="op-div">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="90" />
          </BinaryOp>
        </SetInput>
        <SetVariable id="202" style="set-variable">
          <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
          <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
        </SetVariable>
        <WaitSeconds id="203" style="wait-seconds">
          <Constant text="0.1" />
        </WaitSeconds>
      </Instructions>
    </While>
  </Instructions>
  <Expressions />
  <Instructions>
    <Comment id="9000" style="comment">
      <Constant style="comment-text" canReplace="false" text="State manager receive modules: requests via broadcast to craft STATE_* messages" />
    </Comment>
    <Event event="FlightStart" id="9001" style="flight-start" pos="0,0" />
    <SetVariable id="9002" style="set-variable">
      <Variable list="false" local="false" variableName="ProgramState" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9003" style="set-variable">
      <Variable list="false" local="false" variableName="RequestedState" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9004" style="set-variable">
      <Variable list="false" local="false" variableName="StateChangePending" />
      <Constant text="1" />
    </SetVariable>
    <BroadcastMessage global="false" local="false" id="9005" style="broadcast-msg-craft">
      <Constant text="STATE_STANDBY" />
      <Constant number="0" />
    </BroadcastMessage>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9010" style="receive-msg" pos="950,0">
      <Constant canReplace="false" text="STATE_STANDBY" />
    </Event>
    <SetVariable id="9011" style="set-variable" pos="950,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9012" style="set-variable" pos="950,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9013" style="set-variable" pos="950,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9014" style="set-variable" pos="950,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9015" style="set-variable" pos="950,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9016" style="set-variable" pos="950,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="0" /></SetVariable>
    <SetVariable id="9017" style="set-variable" pos="950,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9018" style="set-variable" pos="950,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9019" style="set-variable" pos="950,1170"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9073" style="set-variable" pos="950,1300"><Variable list="false" local="false" variableName="manual_override" /><Constant text="1" /></SetVariable>
    <SetVariable id="9460" style="set-variable" pos="950,1430"><Variable list="false" local="false" variableName="desired_alt_agl" /><CraftProperty property="Altitude.AGL" style="prop-altitude" /></SetVariable>
    <SetVariable id="9461" style="set-variable" pos="950,1560"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
    <SetVariable id="9462" style="set-variable" pos="950,1690"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9020" style="receive-msg" pos="1900,0"><Constant canReplace="false" text="STATE_ASCENT" /></Event>
    <SetVariable id="9021" style="set-variable" pos="1900,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9022" style="set-variable" pos="1900,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9023" style="set-variable" pos="1900,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9024" style="set-variable" pos="1900,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9025" style="set-variable" pos="1900,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9026" style="set-variable" pos="1900,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="1" /></SetVariable>
    <SetVariable id="9027" style="set-variable" pos="1900,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9028" style="set-variable" pos="1900,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9029" style="set-variable" pos="1900,1170"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
    <SetVariable id="9038" style="set-variable" pos="1900,1300"><Variable list="false" local="false" variableName="manual_override" /><Constant text="0" /></SetVariable>
    <SetVariable id="9463" style="set-variable" pos="1900,1430"><Variable list="false" local="false" variableName="desired_alt_agl" /><Variable list="false" local="false" variableName="hover_alt_target" /></SetVariable>
    <SetVariable id="9464" style="set-variable" pos="1900,1560"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
    <SetVariable id="9465" style="set-variable" pos="1900,1690"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9030" style="receive-msg" pos="2850,0"><Constant canReplace="false" text="STATE_ORBIT" /></Event>
    <SetVariable id="9031" style="set-variable" pos="2850,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9032" style="set-variable" pos="2850,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9033" style="set-variable" pos="2850,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9034" style="set-variable" pos="2850,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9035" style="set-variable" pos="2850,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9036" style="set-variable" pos="2850,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="2" /></SetVariable>
    <SetVariable id="9037" style="set-variable" pos="2850,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9074" style="set-variable" pos="2850,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9075" style="set-variable" pos="2850,1170"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9076" style="set-variable" pos="2850,1300"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
    <SetVariable id="9077" style="set-variable" pos="2850,1430"><Variable list="false" local="false" variableName="manual_override" /><Constant text="0" /></SetVariable>
    <SetVariable id="9466" style="set-variable" pos="2850,1560"><Variable list="false" local="false" variableName="desired_alt_agl" /><Variable list="false" local="false" variableName="hover_alt_target" /></SetVariable>
    <SetVariable id="9467" style="set-variable" pos="2850,1690"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="1" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9040" style="receive-msg" pos="3800,0"><Constant canReplace="false" text="STATE_LANDING" /></Event>
    <SetVariable id="9041" style="set-variable" pos="3800,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9042" style="set-variable" pos="3800,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9043" style="set-variable" pos="3800,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9044" style="set-variable" pos="3800,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9045" style="set-variable" pos="3800,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9046" style="set-variable" pos="3800,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="3" /></SetVariable>
    <SetVariable id="9047" style="set-variable" pos="3800,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9048" style="set-variable" pos="3800,1040"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="1" /></SetVariable>
    <SetVariable id="9049" style="set-variable" pos="3800,1170"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9058" style="set-variable" pos="3800,1300"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9468" style="set-variable" pos="3800,1430"><Variable list="false" local="false" variableName="desired_alt_agl" /><Constant text="0" /></SetVariable>
    <SetVariable id="9469" style="set-variable" pos="3800,1560"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
    <SetVariable id="9470" style="set-variable" pos="3800,1690"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9050" style="receive-msg" pos="4750,0"><Constant canReplace="false" text="STATE_HOVER" /></Event>
    <SetVariable id="9051" style="set-variable" pos="4750,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9052" style="set-variable" pos="4750,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9053" style="set-variable" pos="4750,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9054" style="set-variable" pos="4750,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9055" style="set-variable" pos="4750,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9056" style="set-variable" pos="4750,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="4" /></SetVariable>
    <SetVariable id="9057" style="set-variable" pos="4750,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9059" style="set-variable" pos="4750,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9060" style="set-variable" pos="4750,1170"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
    <SetVariable id="9471" style="set-variable" pos="4750,1300"><Variable list="false" local="false" variableName="desired_alt_agl" /><Variable list="false" local="false" variableName="hover_alt_target" /></SetVariable>
    <SetVariable id="9472" style="set-variable" pos="4750,1430"><Variable list="false" local="false" variableName="desired_pitch" /><Constant text="90" /></SetVariable>
    <SetVariable id="9473" style="set-variable" pos="4750,1560"><Variable list="false" local="false" variableName="desired_heading_hold" /><Constant text="0" /></SetVariable>
  </Instructions>
</Program>
