<?xml version='1.0' encoding='utf-8'?>
<Program name="Quadcopter Flight Program V3.30">
  <Variables>
    <Variable name="auto_enabled" number="0" />
    <Variable name="manual_override" number="0" />
    <Variable name="landing_armed" number="0" />
    <Variable name="nav_enabled" number="0" />
    <Variable name="hover_alt_agl" number="0" />
    <Variable name="hover_alt_target" number="0" />
    <Variable name="auto_alt_agl" number="0" />
    <Variable name="target_alt_agl" number="0" />
    <Variable name="target_north_m" number="0" />
    <Variable name="target_east_m" number="0" />
    <Variable name="target_tolerance_m" number="0" />
    <Variable name="home_pos" number="0" />
    <Variable name="north_hat" number="0" />
    <Variable name="east_hat" number="0" />
    <Variable name="target_pos" number="0" />
    <Variable name="current_pos" number="0" />
    <Variable name="to_target" number="0" />
    <Variable name="distance_to_target" number="0" />
    <Variable name="to_target_hat" number="0" />
    <Variable name="ncomp" number="0" />
    <Variable name="ecomp" number="0" />
    <Variable name="headingrad" number="0" />
    <Variable name="headingdeg" number="0" />
    <Variable name="prop_pitch_deg" number="0" />
    <Variable name="prop_pitch_step" number="0" />
    <Variable name="prop_pitch_thrust_prev" number="0" />
    <Variable name="prop_pitch_thrust_now" number="0" />
    <Variable name="prop_pitch_throttle_zero_s" number="0" />
    <Variable name="ag1_takeoff_hold_cmd" number="0" />
    <Variable name="ag2_land_cmd" number="0" />
    <Variable name="ag3_manual_cmd" number="0" />
    <Variable name="ag4_nav_cmd" number="0" />
    <Variable name="throttle_cmd" number="0" />
    <Variable name="pitch_cmd" number="0" />
    <Variable name="nav_heading_cmd" number="0" />
    <Variable name="nav_heading_error_deg" number="0" />
    <Variable name="heading_hold_enabled" number="0" />
    <Variable name="thread_safe_mode" number="0" />

    <Variable name="ProgramState" number="0" />
    <Variable name="RequestedState" number="0" />
    <Variable name="StateChangePending" number="0" />
    <Variable name="StandbyActive" number="0" />
    <Variable name="AscentActive" number="0" />
    <Variable name="OrbitActive" number="0" />
    <Variable name="LandingActive" number="0" />
    <Variable name="HoverActive" number="0" />
  </Variables>
  <Instructions>
    <Event event="FlightStart" id="0" style="flight-start" pos="0,0" />
    <Comment id="1" style="comment" pos="0,130">
      <Constant style="comment-text" canReplace="false" text="AG1: takeoff + altitude hold | AG4: start nav to target | AG2: land | AG3: manual override" />
    </Comment>
    <SetVariable id="2" style="set-variable" pos="0,260">
      <Variable list="false" local="false" variableName="auto_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="3" style="set-variable" pos="0,390">
      <Variable list="false" local="false" variableName="manual_override" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="4" style="set-variable" pos="0,520">
      <Variable list="false" local="false" variableName="landing_armed" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="5" style="set-variable" pos="0,650">
      <Variable list="false" local="false" variableName="nav_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="304" style="set-variable" pos="0,780">
      <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="305" style="set-variable" pos="0,910">
      <Variable list="false" local="false" variableName="ag2_land_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="306" style="set-variable" pos="0,1040">
      <Variable list="false" local="false" variableName="ag3_manual_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="307" style="set-variable" pos="0,1170">
      <Variable list="false" local="false" variableName="ag4_nav_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="331" style="set-variable" pos="0,1300">
      <Variable list="false" local="false" variableName="throttle_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="332" style="set-variable" pos="0,1430">
      <Variable list="false" local="false" variableName="pitch_cmd" />
      <Constant text="90" />
    </SetVariable>
    <SetVariable id="333" style="set-variable" pos="0,1560">
      <Variable list="false" local="false" variableName="nav_heading_cmd" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="391" style="set-variable" pos="0,1690">
      <Variable list="false" local="false" variableName="nav_heading_error_deg" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="334" style="set-variable" pos="0,1820">
      <Variable list="false" local="false" variableName="heading_hold_enabled" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="362" style="set-variable" pos="0,1950">
      <Variable list="false" local="false" variableName="thread_safe_mode" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="6" style="set-variable" pos="0,2080">
      <Variable list="false" local="false" variableName="target_north_m" />
      <Constant text="1200" />
    </SetVariable>
    <SetVariable id="7" style="set-variable" pos="0,2210">
      <Variable list="false" local="false" variableName="target_east_m" />
      <Constant text="800" />
    </SetVariable>
    <SetVariable id="8" style="set-variable" pos="0,2340">
      <Variable list="false" local="false" variableName="target_tolerance_m" />
      <Constant text="100" />
    </SetVariable>
    <SetVariable id="9069" style="set-variable" pos="0,2470">
      <Variable list="false" local="false" variableName="target_alt_agl" />
      <Constant text="500" />
    </SetVariable>
    <SetVariable id="9" style="set-variable" pos="0,2600">
      <Variable list="false" local="false" variableName="hover_alt_agl" />
      <CraftProperty property="Altitude.AGL" style="prop-altitude" />
    </SetVariable>
    <SetVariable id="9072" style="set-variable" pos="0,2730">
      <Variable list="false" local="false" variableName="hover_alt_target" />
      <Variable list="false" local="false" variableName="hover_alt_agl" />
    </SetVariable>
    <SetVariable id="10" style="set-variable" pos="0,2860">
      <Variable list="false" local="false" variableName="home_pos" />
      <CraftProperty property="Nav.Position" style="prop-nav" />
    </SetVariable>
    <SetVariable id="170" style="set-variable" pos="0,2990">
      <Variable list="false" local="false" variableName="prop_pitch_deg" />
      <Constant text="50" />
    </SetVariable>
    <SetVariable id="171" style="set-variable" pos="0,3120">
      <Variable list="false" local="false" variableName="prop_pitch_step" />
      <Constant text="1" />
    </SetVariable>
    <SetVariable id="172" style="set-variable" pos="0,3250">
      <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
      <CraftProperty property="Performance.CurrentEngineThrust" style="prop-performance" />
    </SetVariable>
    <SetVariable id="190" style="set-variable" pos="0,3380">
      <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
      <Constant text="0" />
    </SetVariable>
    <DisplayMessage id="11" style="display" pos="0,3510">
      <Constant text="Ready. AG1 takeoff/hold, AG4 nav, AG2 land, AG3 manual." />
      <Constant number="7" />
    </DisplayMessage>
    <LogFlight id="360" style="flightlog" pos="0,3640">
      <Constant text="Quadcopter controller initialized: AG1 takeoff/hold, AG4 nav, AG2 land, AG3 manual." />
      <Constant style="false" bool="false" />
    </LogFlight>
    <While id="12" style="while" pos="0,3770">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="27" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="auto_enabled" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <If id="37" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="landing_armed" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <SetVariable id="335" style="set-variable">
                  <Variable list="false" local="false" variableName="pitch_cmd" />
                  <Constant text="90" />
                </SetVariable>
                <SetVariable id="336" style="set-variable">
                  <Variable list="false" local="false" variableName="heading_hold_enabled" />
                  <Constant text="0" />
                </SetVariable>
                <If id="38" style="if">
                  <Comparison op="g" style="op-gt">
                    <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                    <Constant text="20" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="40" style="set-variable">
                      <Variable list="false" local="false" variableName="throttle_cmd" />
                      <Constant text="0.35" />
                    </SetVariable>
                  </Instructions>
                </If>
                <ElseIf id="41" style="else">
                  <Comparison op="g" style="op-gt">
                    <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                    <Constant text="5" />
                  </Comparison>
                  <Instructions>
                    <If id="142" style="if">
                      <Comparison op="g" style="op-gt">
                        <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                        <Constant text="12" />
                      </Comparison>
                      <Instructions>
                        <SetVariable id="143" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <Constant text="0.30" />
                        </SetVariable>
                      </Instructions>
                    </If>
                    <ElseIf id="144" style="else">
                      <Constant style="true" bool="true" />
                      <Instructions>
                        <SetVariable id="145" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <Constant text="0.25" />
                        </SetVariable>
                      </Instructions>
                    </ElseIf>
                  </Instructions>
                </ElseIf>
                <ElseIf id="146" style="else">
                  <Comparison op="g" style="op-gt">
                    <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                    <Constant text="1" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="147" style="set-variable">
                      <Variable list="false" local="false" variableName="throttle_cmd" />
                      <Constant text="0.18" />
                    </SetVariable>
                  </Instructions>
                </ElseIf>
                <ElseIf id="148" style="else">
                  <Constant style="true" bool="true" />
                  <Instructions>
                    <If id="9101" style="if">
                      <BoolOp op="and" style="op-and">
                        <Comparison op="l" style="op-lt">
                          <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                          <Constant text="1" />
                        </Comparison>
                        <BoolOp op="and" style="op-and">
                          <Comparison op="g" style="op-gt">
                            <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            <Constant text="-0.6" />
                          </Comparison>
                          <Comparison op="l" style="op-lt">
                            <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            <Constant text="0.6" />
                          </Comparison>
                        </BoolOp>
                      </BoolOp>
                      <Instructions>
                        <SetVariable id="42" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <Constant text="0" />
                        </SetVariable>
                        <SetVariable id="149" style="set-variable">
                          <Variable list="false" local="false" variableName="landing_armed" />
                          <Constant text="0" />
                        </SetVariable>
                        <SetVariable id="43" style="set-variable">
                          <Variable list="false" local="false" variableName="auto_enabled" />
                          <Constant text="0" />
                        </SetVariable>
                        <SetVariable id="44" style="set-variable">
                          <Variable list="false" local="false" variableName="nav_enabled" />
                          <Constant text="0" />
                        </SetVariable>
                        <DisplayMessage id="9102" style="display">
                          <Constant text="Landing: touchdown confirmed." />
                          <Constant number="2" />
                        </DisplayMessage>
                        <LogFlight id="9103" style="flightlog">
                          <Constant text="Landing: touchdown confirmed, throttle shutdown and auto/nav disabled." />
                          <Constant style="false" bool="false" />
                        </LogFlight>
                      </Instructions>
                    </If>
                    <ElseIf id="9104" style="else">
                      <Constant style="true" bool="true" />
                      <Instructions>
                        <SetVariable id="9105" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <Constant text="0.12" />
                        </SetVariable>
                      </Instructions>
                    </ElseIf>
                  </Instructions>
                </ElseIf>
              </Instructions>
            </If>
            <ElseIf id="45" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <SetVariable id="337" style="set-variable">
                  <Variable list="false" local="false" variableName="pitch_cmd" />
                  <Constant text="90" />
                </SetVariable>
                <If id="46" style="if">
                  <Comparison op="=" style="op-eq">
                    <Variable list="false" local="false" variableName="nav_enabled" />
                    <Constant text="1" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="47" style="set-variable">
                      <Variable list="false" local="false" variableName="north_hat" />
                      <VectorOp op="norm" style="vec-op-1">
                        <CraftProperty property="Nav.North" style="prop-nav" />
                      </VectorOp>
                    </SetVariable>
                    <SetVariable id="48" style="set-variable">
                      <Variable list="false" local="false" variableName="east_hat" />
                      <VectorOp op="norm" style="vec-op-1">
                        <CraftProperty property="Nav.East" style="prop-nav" />
                      </VectorOp>
                    </SetVariable>
                    <SetVariable id="49" style="set-variable">
                      <Variable list="false" local="false" variableName="target_pos" />
                      <BinaryOp op="+" style="op-add">
                        <BinaryOp op="+" style="op-add">
                          <Variable list="false" local="false" variableName="home_pos" />
                          <BinaryOp op="*" style="op-mul">
                            <Variable list="false" local="false" variableName="north_hat" />
                            <Variable list="false" local="false" variableName="target_north_m" />
                          </BinaryOp>
                        </BinaryOp>
                        <BinaryOp op="*" style="op-mul">
                          <Variable list="false" local="false" variableName="east_hat" />
                          <Variable list="false" local="false" variableName="target_east_m" />
                        </BinaryOp>
                      </BinaryOp>
                    </SetVariable>
                    <SetVariable id="50" style="set-variable">
                      <Variable list="false" local="false" variableName="current_pos" />
                      <CraftProperty property="Nav.Position" style="prop-nav" />
                    </SetVariable>
                    <SetVariable id="51" style="set-variable">
                      <Variable list="false" local="false" variableName="to_target" />
                      <BinaryOp op="-" style="op-sub">
                        <Variable list="false" local="false" variableName="target_pos" />
                        <Variable list="false" local="false" variableName="current_pos" />
                      </BinaryOp>
                    </SetVariable>
                    <SetVariable id="52" style="set-variable">
                      <Variable list="false" local="false" variableName="distance_to_target" />
                      <VectorOp op="length" style="vec-op-1">
                        <Variable list="false" local="false" variableName="to_target" />
                      </VectorOp>
                    </SetVariable>
                    <If id="53" style="if">
                      <Comparison op="g" style="op-gt">
                        <Variable list="false" local="false" variableName="distance_to_target" />
                        <Variable list="false" local="false" variableName="target_tolerance_m" />
                      </Comparison>
                      <Instructions>
                        <SetVariable id="54" style="set-variable">
                          <Variable list="false" local="false" variableName="to_target_hat" />
                          <VectorOp op="norm" style="vec-op-1">
                            <Variable list="false" local="false" variableName="to_target" />
                          </VectorOp>
                        </SetVariable>
                        <SetVariable id="55" style="set-variable">
                          <Variable list="false" local="false" variableName="ncomp" />
                          <VectorOp op="dot" style="vec-op-2">
                            <Variable list="false" local="false" variableName="to_target_hat" />
                            <Variable list="false" local="false" variableName="north_hat" />
                          </VectorOp>
                        </SetVariable>
                        <SetVariable id="56" style="set-variable">
                          <Variable list="false" local="false" variableName="ecomp" />
                          <VectorOp op="dot" style="vec-op-2">
                            <Variable list="false" local="false" variableName="to_target_hat" />
                            <Variable list="false" local="false" variableName="east_hat" />
                          </VectorOp>
                        </SetVariable>
                        <SetVariable id="57" style="set-variable">
                          <Variable list="false" local="false" variableName="headingrad" />
                          <BinaryOp op="atan2" style="op-atan-2">
                            <Variable list="false" local="false" variableName="ecomp" />
                            <Variable list="false" local="false" variableName="ncomp" />
                          </BinaryOp>
                        </SetVariable>
                        <SetVariable id="58" style="set-variable">
                          <Variable list="false" local="false" variableName="headingdeg" />
                          <MathFunction function="rad2deg" style="op-math">
                            <Variable list="false" local="false" variableName="headingrad" />
                          </MathFunction>
                        </SetVariable>
                        <If id="60" style="if">
                          <Comparison op="l" style="op-lt">
                            <Variable list="false" local="false" variableName="headingdeg" />
                            <Constant text="0" />
                          </Comparison>
                          <Instructions>
                            <SetVariable id="61" style="set-variable">
                              <Variable list="false" local="false" variableName="headingdeg" />
                              <BinaryOp op="+" style="op-add">
                                <Variable list="false" local="false" variableName="headingdeg" />
                                <Constant text="360" />
                              </BinaryOp>
                            </SetVariable>
                          </Instructions>
                        </If>
                        <SetVariable id="338" style="set-variable">
                          <Variable list="false" local="false" variableName="nav_heading_cmd" />
                          <Variable list="false" local="false" variableName="headingdeg" />
                        </SetVariable>
                        <SetVariable id="339" style="set-variable">
                          <Variable list="false" local="false" variableName="heading_hold_enabled" />
                          <Constant text="1" />
                        </SetVariable>
                        <SetVariable id="392" style="set-variable">
                          <Variable list="false" local="false" variableName="nav_heading_error_deg" />
                          <MathFunction function="abs" style="op-math">
                            <BinaryOp op="-" style="op-sub">
                              <Variable list="false" local="false" variableName="nav_heading_cmd" />
                              <CraftProperty property="Nav.CraftHeading" style="prop-nav" />
                            </BinaryOp>
                          </MathFunction>
                        </SetVariable>
                        <If id="393" style="if">
                          <Comparison op="g" style="op-gt">
                            <Variable list="false" local="false" variableName="nav_heading_error_deg" />
                            <Constant text="180" />
                          </Comparison>
                          <Instructions>
                            <SetVariable id="394" style="set-variable">
                              <Variable list="false" local="false" variableName="nav_heading_error_deg" />
                              <BinaryOp op="-" style="op-sub">
                                <Constant text="360" />
                                <Variable list="false" local="false" variableName="nav_heading_error_deg" />
                              </BinaryOp>
                            </SetVariable>
                          </Instructions>
                        </If>
                        <If id="395" style="if">
                          <Comparison op="l" style="op-lt">
                            <Variable list="false" local="false" variableName="nav_heading_error_deg" />
                            <Constant text="15" />
                          </Comparison>
                          <Instructions>
                            <If id="396" style="if">
                              <Comparison op="g" style="op-gt">
                                <Variable list="false" local="false" variableName="distance_to_target" />
                                <BinaryOp op="*" style="op-mul">
                                  <Variable list="false" local="false" variableName="target_tolerance_m" />
                                  <Constant text="4" />
                                </BinaryOp>
                              </Comparison>
                              <Instructions>
                                <SetVariable id="397" style="set-variable">
                                  <Variable list="false" local="false" variableName="pitch_cmd" />
                                  <Constant text="78" />
                                </SetVariable>
                              </Instructions>
                            </If>
                            <ElseIf id="398" style="else">
                              <Comparison op="g" style="op-gt">
                                <Variable list="false" local="false" variableName="distance_to_target" />
                                <BinaryOp op="*" style="op-mul">
                                  <Variable list="false" local="false" variableName="target_tolerance_m" />
                                  <Constant text="1.5" />
                                </BinaryOp>
                              </Comparison>
                              <Instructions>
                                <SetVariable id="399" style="set-variable">
                                  <Variable list="false" local="false" variableName="pitch_cmd" />
                                  <Constant text="102" />
                                </SetVariable>
                              </Instructions>
                            </ElseIf>
                            <ElseIf id="400" style="else">
                              <Constant style="true" bool="true" />
                              <Instructions>
                                <SetVariable id="401" style="set-variable">
                                  <Variable list="false" local="false" variableName="pitch_cmd" />
                                  <Constant text="90" />
                                </SetVariable>
                              </Instructions>
                            </ElseIf>
                          </Instructions>
                        </If>
                        <ElseIf id="402" style="else">
                          <Constant style="true" bool="true" />
                          <Instructions>
                            <SetVariable id="403" style="set-variable">
                              <Variable list="false" local="false" variableName="pitch_cmd" />
                              <Constant text="90" />
                            </SetVariable>
                          </Instructions>
                        </ElseIf>
                      </Instructions>
                    </If>
                    <If id="156" style="if">
                      <Comparison op="g" style="op-gt">
                        <Variable list="false" local="false" variableName="distance_to_target" />
                        <Variable list="false" local="false" variableName="target_tolerance_m" />
                      </Comparison>
                      <Instructions>
                        <SetVariable id="68" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <BinaryOp op="-" style="op-sub">
                            <BinaryOp op="+" style="op-add">
                              <Constant text="0.5" />
                              <BinaryOp op="*" style="op-mul">
                                <Constant text="0.004" />
                                <BinaryOp op="-" style="op-sub">
                                  <Variable list="false" local="false" variableName="auto_alt_agl" />
                                  <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                                </BinaryOp>
                              </BinaryOp>
                            </BinaryOp>
                            <BinaryOp op="*" style="op-mul">
                              <Constant text="0.02" />
                              <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            </BinaryOp>
                          </BinaryOp>
                        </SetVariable>
                      </Instructions>
                    </If>
                    <ElseIf id="157" style="else">
                      <Constant style="true" bool="true" />
                      <Instructions>
                        <SetVariable id="158" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <BinaryOp op="-" style="op-sub">
                            <BinaryOp op="+" style="op-add">
                              <Constant text="0.5" />
                              <BinaryOp op="*" style="op-mul">
                                <Constant text="0.004" />
                                <BinaryOp op="-" style="op-sub">
                                  <Variable list="false" local="false" variableName="auto_alt_agl" />
                                  <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                                </BinaryOp>
                              </BinaryOp>
                            </BinaryOp>
                            <BinaryOp op="*" style="op-mul">
                              <Constant text="0.02" />
                              <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            </BinaryOp>
                          </BinaryOp>
                        </SetVariable>
                        <SetVariable id="159" style="set-variable">
                          <Variable list="false" local="false" variableName="nav_enabled" />
                          <Constant text="0" />
                        </SetVariable>
                        <SetVariable id="340" style="set-variable">
                          <Variable list="false" local="false" variableName="heading_hold_enabled" />
                          <Constant text="0" />
                        </SetVariable>
                        <SetVariable id="404" style="set-variable">
                          <Variable list="false" local="false" variableName="pitch_cmd" />
                          <Constant text="90" />
                        </SetVariable>
                        <SetVariable id="160" style="set-variable">
                          <Variable list="false" local="false" variableName="hover_alt_agl" />
                          <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                        </SetVariable>
                        <SetVariable id="9095" style="set-variable">
                          <Variable list="false" local="false" variableName="hover_alt_target" />
                          <Variable list="false" local="false" variableName="hover_alt_agl" />
                        </SetVariable>
                        <DisplayMessage id="161" style="display">
                          <Constant text="Target reached. Holding position." />
                          <Constant number="3" />
                        </DisplayMessage>
                        <LogFlight id="361" style="flightlog">
                          <Constant text="Navigation target reached. Nav disabled and altitude hold captured." />
                          <Constant style="false" bool="false" />
                        </LogFlight>
                      </Instructions>
                    </ElseIf>
                  </Instructions>
                </If>
                <ElseIf id="69" style="else">
                  <Constant style="true" bool="true" />
                  <Instructions>
                    <SetVariable id="341" style="set-variable">
                      <Variable list="false" local="false" variableName="heading_hold_enabled" />
                      <Constant text="0" />
                    </SetVariable>
                    <If id="70" style="if">
                      <Comparison op="l" style="op-lt">
                        <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                        <Variable list="false" local="false" variableName="hover_alt_target" />
                      </Comparison>
                      <Instructions>
                        <SetVariable id="72" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <BinaryOp op="-" style="op-sub">
                            <BinaryOp op="+" style="op-add">
                              <Constant text="0.5" />
                              <BinaryOp op="*" style="op-mul">
                                <Constant text="0.005" />
                                <BinaryOp op="-" style="op-sub">
                                  <Variable list="false" local="false" variableName="hover_alt_target" />
                                  <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                                </BinaryOp>
                              </BinaryOp>
                            </BinaryOp>
                            <BinaryOp op="*" style="op-mul">
                              <Constant text="0.02" />
                              <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            </BinaryOp>
                          </BinaryOp>
                        </SetVariable>
                      </Instructions>
                    </If>
                    <ElseIf id="73" style="else">
                      <Constant style="true" bool="true" />
                      <Instructions>
                        <SetVariable id="75" style="set-variable">
                          <Variable list="false" local="false" variableName="throttle_cmd" />
                          <BinaryOp op="-" style="op-sub">
                            <BinaryOp op="+" style="op-add">
                              <Constant text="0.5" />
                              <BinaryOp op="*" style="op-mul">
                                <Constant text="0.005" />
                                <BinaryOp op="-" style="op-sub">
                                  <Variable list="false" local="false" variableName="hover_alt_target" />
                                  <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                                </BinaryOp>
                              </BinaryOp>
                            </BinaryOp>
                            <BinaryOp op="*" style="op-mul">
                              <Constant text="0.02" />
                              <CraftProperty property="Vel.VerticalSurfaceVelocity" style="prop-velocity" />
                            </BinaryOp>
                          </BinaryOp>
                        </SetVariable>
                      </Instructions>
                    </ElseIf>
                  </Instructions>
                </ElseIf>
              </Instructions>
            </ElseIf>
          </Instructions>
        </If>
        <If id="76" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <SetVariable id="77" style="set-variable">
              <Variable list="false" local="false" variableName="hover_alt_agl" />
              <CraftProperty property="Altitude.AGL" style="prop-altitude" />
            </SetVariable>
            <SetVariable id="9096" style="set-variable">
              <Variable list="false" local="false" variableName="hover_alt_target" />
              <Variable list="false" local="false" variableName="hover_alt_agl" />
            </SetVariable>
            <SetVariable id="342" style="set-variable">
              <Variable list="false" local="false" variableName="heading_hold_enabled" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <ElseIf id="163" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <SetVariable id="164" style="set-variable">
              <Variable list="false" local="false" variableName="auto_alt_agl" />
              <BinaryOp op="+" style="op-add">
                <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                <Variable list="false" local="false" variableName="target_alt_agl" />
              </BinaryOp>
            </SetVariable>
          </Instructions>
        </ElseIf>
        <WaitSeconds id="78" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="356" style="comment" pos="0,3900">
      <Constant style="comment-text" canReplace="false" text="Thread: applies computed throttle_cmd to slider1 when not in manual override." />
    </Comment>
    <Event event="FlightStart" id="344" style="flight-start" pos="0,4030" />
    <While id="345" style="while" pos="0,4160">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="346" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <If id="363" style="if">
              <Comparison op="l" style="op-lt">
                <Variable list="false" local="false" variableName="throttle_cmd" />
                <Constant text="0" />
              </Comparison>
              <Instructions>
                <SetVariable id="364" style="set-variable">
                  <Variable list="false" local="false" variableName="throttle_cmd" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </If>
            <If id="365" style="if">
              <Comparison op="g" style="op-gt">
                <Variable list="false" local="false" variableName="throttle_cmd" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <SetVariable id="366" style="set-variable">
                  <Variable list="false" local="false" variableName="throttle_cmd" />
                  <Constant text="1" />
                </SetVariable>
              </Instructions>
            </If>
            <SetInput input="slider1" id="347" style="set-input">
              <Variable list="false" local="false" variableName="throttle_cmd" />
            </SetInput>
          </Instructions>
        </If>
        <WaitSeconds id="348" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="357" style="comment" pos="0,4290">
      <Constant style="comment-text" canReplace="false" text="Thread: applies pitch_cmd and optional heading hold for navigation." />
    </Comment>
    <Event event="FlightStart" id="349" style="flight-start" pos="0,4420" />
    <While id="350" style="while" pos="0,4550">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="351" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="manual_override" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <If id="367" style="if">
              <Comparison op="l" style="op-lt">
                <Variable list="false" local="false" variableName="pitch_cmd" />
                <Constant text="0" />
              </Comparison>
              <Instructions>
                <SetVariable id="368" style="set-variable">
                  <Variable list="false" local="false" variableName="pitch_cmd" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </If>
            <If id="369" style="if">
              <Comparison op="g" style="op-gt">
                <Variable list="false" local="false" variableName="pitch_cmd" />
                <Constant text="180" />
              </Comparison>
              <Instructions>
                <SetVariable id="370" style="set-variable">
                  <Variable list="false" local="false" variableName="pitch_cmd" />
                  <Constant text="180" />
                </SetVariable>
              </Instructions>
            </If>
            <SetTargetHeading property="pitch" id="352" style="set-heading">
              <Variable list="false" local="false" variableName="pitch_cmd" />
            </SetTargetHeading>
            <If id="353" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="heading_hold_enabled" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <If id="371" style="if">
                  <Comparison op="l" style="op-lt">
                    <Variable list="false" local="false" variableName="nav_heading_cmd" />
                    <Constant text="0" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="372" style="set-variable">
                      <Variable list="false" local="false" variableName="nav_heading_cmd" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="nav_heading_cmd" />
                        <Constant text="360" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <If id="373" style="if">
                  <Comparison op="g" style="op-gt">
                    <Variable list="false" local="false" variableName="nav_heading_cmd" />
                    <Constant text="360" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="374" style="set-variable">
                      <Variable list="false" local="false" variableName="nav_heading_cmd" />
                      <BinaryOp op="-" style="op-sub">
                        <Variable list="false" local="false" variableName="nav_heading_cmd" />
                        <Constant text="360" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <SetTargetHeading property="heading" id="354" style="set-heading">
                  <Variable list="false" local="false" variableName="nav_heading_cmd" />
                </SetTargetHeading>
              </Instructions>
            </If>
          </Instructions>
        </If>
        <WaitSeconds id="355" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="358" style="comment" pos="0,4680">
      <Constant style="comment-text" canReplace="false" text="Thread: activation-group state manager for AG1/AG2/AG3/AG4 mode commands." />
    </Comment>
    <Event event="FlightStart" id="300" style="flight-start" pos="0,4810" />
    <While id="301" style="while" pos="0,4940">
      <Constant style="true" bool="true" />
      <Instructions>
        <SetVariable id="308" style="set-variable">
          <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="1" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="309" style="set-variable">
          <Variable list="false" local="false" variableName="ag2_land_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="2" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="310" style="set-variable">
          <Variable list="false" local="false" variableName="ag3_manual_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="3" />
          </ActivationGroup>
        </SetVariable>
        <SetVariable id="311" style="set-variable">
          <Variable list="false" local="false" variableName="ag4_nav_cmd" />
          <ActivationGroup style="activation-group">
            <Constant number="4" />
          </ActivationGroup>
        </SetVariable>
        <If id="312" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="ag3_manual_cmd" />
            <Constant style="true" bool="true" />
          </Comparison>
          <Instructions>
            <SetVariable id="313" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9061" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="9062" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="314" style="set-variable">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="315" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <ElseIf id="316" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <SetVariable id="317" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </ElseIf>
        <If id="375" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="thread_safe_mode" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <If id="376" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="manual_override" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <SetVariable id="377" style="set-variable">
                  <Variable list="false" local="false" variableName="auto_enabled" />
                  <Constant text="0" />
                </SetVariable>
                <SetVariable id="378" style="set-variable">
                  <Variable list="false" local="false" variableName="nav_enabled" />
                  <Constant text="0" />
                </SetVariable>
                <SetVariable id="379" style="set-variable">
                  <Variable list="false" local="false" variableName="heading_hold_enabled" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </If>
          </Instructions>
        </If>
        <If id="318" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="ag1_takeoff_hold_cmd" />
            <Constant style="true" bool="true" />
          </Comparison>
          <Instructions>
            <SetVariable id="319" style="set-variable">
              <Variable list="false" local="false" variableName="manual_override" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="9064" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="9065" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="320" style="set-variable">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="321" style="set-variable">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="322" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="323" style="set-variable">
              <Variable list="false" local="false" variableName="hover_alt_target" />
              <BinaryOp op="+" style="op-add">
                <CraftProperty property="Altitude.AGL" style="prop-altitude" />
                <Variable list="false" local="false" variableName="target_alt_agl" />
              </BinaryOp>
            </SetVariable>
            <SetVariable id="324" style="set-variable">
              <Variable list="false" local="false" variableName="home_pos" />
              <CraftProperty property="Nav.Position" style="prop-nav" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="325" style="if">
          <BoolOp op="and" style="op-and">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="ag4_nav_cmd" />
              <Constant style="true" bool="true" />
            </Comparison>
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="9067" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="2" />
            </SetVariable>
            <SetVariable id="9068" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="326" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="1" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="327" style="if">
          <BoolOp op="and" style="op-and">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="ag2_land_cmd" />
              <Constant style="true" bool="true" />
            </Comparison>
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="auto_enabled" />
              <Constant text="1" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="9070" style="set-variable">
              <Variable list="false" local="false" variableName="RequestedState" />
              <Constant text="3" />
            </SetVariable>
            <SetVariable id="9071" style="set-variable">
              <Variable list="false" local="false" variableName="StateChangePending" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="328" style="set-variable">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="329" style="set-variable">
              <Variable list="false" local="false" variableName="nav_enabled" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <WaitSeconds id="330" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="9080" style="comment" pos="0,5070">
      <Constant style="comment-text" canReplace="false" text="Thread: state transition dispatcher; broadcasts STATE_* only when StateChangePending is set." />
    </Comment>
    <Event event="FlightStart" id="9081" style="flight-start" pos="0,5200" />
    <While id="9082" style="while" pos="0,5330">
      <Constant style="true" bool="true" />
      <Instructions>
        <If id="9083" style="if">
          <Comparison op="=" style="op-eq">
            <Variable list="false" local="false" variableName="StateChangePending" />
            <Constant text="1" />
          </Comparison>
          <Instructions>
            <If id="9084" style="if">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="0" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9085" style="broadcast-msg-craft">
                  <Constant text="STATE_STANDBY" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </If>
            <ElseIf id="9086" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="1" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9087" style="broadcast-msg-craft">
                  <Constant text="STATE_ASCENT" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9088" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="2" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9089" style="broadcast-msg-craft">
                  <Constant text="STATE_ORBIT" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9090" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="3" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9091" style="broadcast-msg-craft">
                  <Constant text="STATE_LANDING" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
            <ElseIf id="9092" style="else">
              <Comparison op="=" style="op-eq">
                <Variable list="false" local="false" variableName="RequestedState" />
                <Constant text="4" />
              </Comparison>
              <Instructions>
                <BroadcastMessage global="false" local="false" id="9093" style="broadcast-msg-craft">
                  <Constant text="STATE_HOVER" />
                  <Constant number="0" />
                </BroadcastMessage>
              </Instructions>
            </ElseIf>
          </Instructions>
        </If>
        <WaitSeconds id="9094" style="wait-seconds">
          <Constant text="0.05" />
        </WaitSeconds>
      </Instructions>
    </While>
    <Comment id="359" style="comment" pos="0,5460">
      <Constant style="comment-text" canReplace="false" text="Thread: variable-pitch prop optimization with zero-throttle and landing safeguards." />
    </Comment>
    <Event event="FlightStart" id="173" style="flight-start" pos="0,5590" />
    <While id="174" style="while" pos="0,5720">
      <Constant style="true" bool="true" />
      <Instructions>
        <SetVariable id="175" style="set-variable">
          <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
          <CraftProperty property="Performance.CurrentEngineThrust" style="prop-performance" />
        </SetVariable>
        <If id="176" style="if">
          <BoolOp op="or" style="op-or">
            <Comparison op="=" style="op-eq">
              <Variable list="false" local="false" variableName="landing_armed" />
              <Constant text="1" />
            </Comparison>
            <Comparison op="l" style="op-lt">
              <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
              <Constant text="0.01" />
            </Comparison>
          </BoolOp>
          <Instructions>
            <SetVariable id="177" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="50" />
            </SetVariable>
            <SetVariable id="178" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="1" />
            </SetVariable>
            <SetVariable id="179" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
              <Constant text="0" />
            </SetVariable>
          </Instructions>
        </If>
        <ElseIf id="180" style="else">
          <Constant style="true" bool="true" />
          <Instructions>
            <If id="181" style="if">
              <Comparison op="l" style="op-lt">
                <CraftProperty property="Input.Throttle" style="prop-input" />
                <Constant text="0.01" />
              </Comparison>
              <Instructions>
                <SetVariable id="182" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                  <BinaryOp op="+" style="op-add">
                    <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                    <CraftProperty property="Time.FrameDeltaTime" style="prop-time" />
                  </BinaryOp>
                </SetVariable>
              </Instructions>
            </If>
            <ElseIf id="183" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <SetVariable id="184" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                  <Constant text="0" />
                </SetVariable>
              </Instructions>
            </ElseIf>
            <If id="185" style="if">
              <Comparison op="g" style="op-gt">
                <Variable list="false" local="false" variableName="prop_pitch_throttle_zero_s" />
                <Constant text="2" />
              </Comparison>
              <Instructions>
                <SetVariable id="186" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_deg" />
                  <Constant text="50" />
                </SetVariable>
                <SetVariable id="187" style="set-variable">
                  <Variable list="false" local="false" variableName="prop_pitch_step" />
                  <Constant text="1" />
                </SetVariable>
              </Instructions>
            </If>
            <ElseIf id="188" style="else">
              <Constant style="true" bool="true" />
              <Instructions>
                <If id="189" style="if">
                  <Comparison op="g" style="op-gt">
                    <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
                    <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
                  </Comparison>
                  <Instructions>
                    <SetVariable id="191" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_deg" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="prop_pitch_deg" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </If>
                <ElseIf id="192" style="else">
                  <Constant style="true" bool="true" />
                  <Instructions>
                    <SetVariable id="193" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_step" />
                      <BinaryOp op="*" style="op-mul">
                        <Constant text="-1" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                    <SetVariable id="194" style="set-variable">
                      <Variable list="false" local="false" variableName="prop_pitch_deg" />
                      <BinaryOp op="+" style="op-add">
                        <Variable list="false" local="false" variableName="prop_pitch_deg" />
                        <Variable list="false" local="false" variableName="prop_pitch_step" />
                      </BinaryOp>
                    </SetVariable>
                  </Instructions>
                </ElseIf>
              </Instructions>
            </ElseIf>
          </Instructions>
        </ElseIf>
        <If id="195" style="if">
          <Comparison op="g" style="op-gt">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="90" />
          </Comparison>
          <Instructions>
            <SetVariable id="196" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="90" />
            </SetVariable>
            <SetVariable id="197" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="-1" />
            </SetVariable>
          </Instructions>
        </If>
        <If id="198" style="if">
          <Comparison op="l" style="op-lt">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="0" />
          </Comparison>
          <Instructions>
            <SetVariable id="199" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_deg" />
              <Constant text="0" />
            </SetVariable>
            <SetVariable id="200" style="set-variable">
              <Variable list="false" local="false" variableName="prop_pitch_step" />
              <Constant text="1" />
            </SetVariable>
          </Instructions>
        </If>
        <SetInput input="slider2" id="201" style="set-input">
          <BinaryOp op="/" style="op-div">
            <Variable list="false" local="false" variableName="prop_pitch_deg" />
            <Constant text="90" />
          </BinaryOp>
        </SetInput>
        <SetVariable id="202" style="set-variable">
          <Variable list="false" local="false" variableName="prop_pitch_thrust_prev" />
          <Variable list="false" local="false" variableName="prop_pitch_thrust_now" />
        </SetVariable>
        <WaitSeconds id="203" style="wait-seconds">
          <Constant text="0.1" />
        </WaitSeconds>
      </Instructions>
    </While>
  </Instructions>
  <Expressions />
  <Instructions>
    <Comment id="9000" style="comment">
      <Constant style="comment-text" canReplace="false" text="State manager receive modules: requests via broadcast to craft STATE_* messages" />
    </Comment>
    <Event event="FlightStart" id="9001" style="flight-start" pos="0,0" />
    <SetVariable id="9002" style="set-variable">
      <Variable list="false" local="false" variableName="ProgramState" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9003" style="set-variable">
      <Variable list="false" local="false" variableName="RequestedState" />
      <Constant text="0" />
    </SetVariable>
    <SetVariable id="9004" style="set-variable">
      <Variable list="false" local="false" variableName="StateChangePending" />
      <Constant text="1" />
    </SetVariable>
    <BroadcastMessage global="false" local="false" id="9005" style="broadcast-msg-craft">
      <Constant text="STATE_STANDBY" />
      <Constant number="0" />
    </BroadcastMessage>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9010" style="receive-msg" pos="950,0">
      <Constant canReplace="false" text="STATE_STANDBY" />
    </Event>
    <SetVariable id="9011" style="set-variable" pos="950,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9012" style="set-variable" pos="950,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9013" style="set-variable" pos="950,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9014" style="set-variable" pos="950,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9015" style="set-variable" pos="950,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9016" style="set-variable" pos="950,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="0" /></SetVariable>
    <SetVariable id="9017" style="set-variable" pos="950,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9018" style="set-variable" pos="950,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9019" style="set-variable" pos="950,1170"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9073" style="set-variable" pos="950,1300"><Variable list="false" local="false" variableName="manual_override" /><Constant text="1" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9020" style="receive-msg" pos="1900,0"><Constant canReplace="false" text="STATE_ASCENT" /></Event>
    <SetVariable id="9021" style="set-variable" pos="1900,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9022" style="set-variable" pos="1900,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9023" style="set-variable" pos="1900,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9024" style="set-variable" pos="1900,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9025" style="set-variable" pos="1900,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9026" style="set-variable" pos="1900,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="1" /></SetVariable>
    <SetVariable id="9027" style="set-variable" pos="1900,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9028" style="set-variable" pos="1900,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9029" style="set-variable" pos="1900,1170"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
    <SetVariable id="9038" style="set-variable" pos="1900,1300"><Variable list="false" local="false" variableName="manual_override" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9030" style="receive-msg" pos="2850,0"><Constant canReplace="false" text="STATE_ORBIT" /></Event>
    <SetVariable id="9031" style="set-variable" pos="2850,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9032" style="set-variable" pos="2850,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9033" style="set-variable" pos="2850,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9034" style="set-variable" pos="2850,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9035" style="set-variable" pos="2850,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9036" style="set-variable" pos="2850,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="2" /></SetVariable>
    <SetVariable id="9037" style="set-variable" pos="2850,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9074" style="set-variable" pos="2850,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9075" style="set-variable" pos="2850,1170"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9076" style="set-variable" pos="2850,1300"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
    <SetVariable id="9077" style="set-variable" pos="2850,1430"><Variable list="false" local="false" variableName="manual_override" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9040" style="receive-msg" pos="3800,0"><Constant canReplace="false" text="STATE_LANDING" /></Event>
    <SetVariable id="9041" style="set-variable" pos="3800,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9042" style="set-variable" pos="3800,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9043" style="set-variable" pos="3800,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9044" style="set-variable" pos="3800,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9045" style="set-variable" pos="3800,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9046" style="set-variable" pos="3800,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="3" /></SetVariable>
    <SetVariable id="9047" style="set-variable" pos="3800,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9048" style="set-variable" pos="3800,1040"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="1" /></SetVariable>
    <SetVariable id="9049" style="set-variable" pos="3800,1170"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="0" /></SetVariable>
    <SetVariable id="9058" style="set-variable" pos="3800,1300"><Variable list="false" local="false" variableName="nav_enabled" /><Constant text="0" /></SetVariable>
  </Instructions>
  <Instructions>
    <Event event="ReceiveMessage" id="9050" style="receive-msg" pos="4750,0"><Constant canReplace="false" text="STATE_HOVER" /></Event>
    <SetVariable id="9051" style="set-variable" pos="4750,130"><Variable list="false" local="false" variableName="StandbyActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9052" style="set-variable" pos="4750,260"><Variable list="false" local="false" variableName="AscentActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9053" style="set-variable" pos="4750,390"><Variable list="false" local="false" variableName="OrbitActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9054" style="set-variable" pos="4750,520"><Variable list="false" local="false" variableName="LandingActive" /><Constant text="0" /></SetVariable>
    <SetVariable id="9055" style="set-variable" pos="4750,650"><Variable list="false" local="false" variableName="HoverActive" /><Constant text="1" /></SetVariable>
    <SetVariable id="9056" style="set-variable" pos="4750,780"><Variable list="false" local="false" variableName="ProgramState" /><Constant text="4" /></SetVariable>
    <SetVariable id="9057" style="set-variable" pos="4750,910"><Variable list="false" local="false" variableName="StateChangePending" /><Constant text="0" /></SetVariable>
    <SetVariable id="9059" style="set-variable" pos="4750,1040"><Variable list="false" local="false" variableName="auto_enabled" /><Constant text="1" /></SetVariable>
    <SetVariable id="9060" style="set-variable" pos="4750,1170"><Variable list="false" local="false" variableName="landing_armed" /><Constant text="0" /></SetVariable>
  </Instructions>
</Program>
